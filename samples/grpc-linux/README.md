# gRPC keyLess mTLS demo
## gRPC Build setup 
```
git clone -b v1.41.1 https://github.com/grpc/grpc
cd grpc
git submodule update --init

mkdir -p cmake/build
cd cmake/build
cmake ../.. -DgRPC_INSTALL=ON -DgRPC_SSL_PROVIDER=package
make -j `nproc`
sudo make install
```
## Important
It is important to specify -DgRPC_SSL_PROVIDER with package OpenSSL
The default SSL provider boringssl does not support OpenSSL engine
See https://github.com/grpc/grpc/blob/master/src/core/tsi/ssl_transport_security.cc#:~:text=r%27%2C%20%27p%27%2C%20%27c%27%7D%3B-,%23if%20!defined(OPENSSL_IS_BORINGSSL)%20%26%26%20!defined(OPENSSL_NO_ENGINE),%23endif,-%23if%20OPENSSL_VERSION_NUMBER%20%3C%200x10100000

## build greeter client/server
```
mkdir build
cd build
cmake ..
build
```

## Testing
NOTE: run the test in the parent directory of build/
### server with EC cert
```
./ec_server.sh 
```
### client with EC cert
```
 ./ec_client.sh
```

### server with RSA cert
```
 ./rsa_server.sh 
```
### client with RSA cert
```
 ./rsa_client.sh
```

### running log for server with RSA cert
```
grpc-linux$ ./rsa_server.sh
Root Certs:
-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIQXsiKAgAAGp9P6sTRS5/xtDANBgkqhkiG9w0BAQsFADAX
MRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwHhcNMjExMDExMDMxODE2WhcNMjIxMDEx
MDMzODE2WjAXMRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQC8VDcLWvgYh5Trb47wuhxBxNb491089M+taAypWfC3
jGAnMoGV0gF54tNiBTUPeI50cwpFL5TIOzQaw9WnFvAEbkPhQv8wL7GLsXXLsAZc
VAdHdOcvCjKb51pOq69hFd41dOCa1EJn83Tq8SHdG+essoXlBWL1+sfu3zPsW8SO
wSgeLPQQJ3c6C6/V+f/RxbAZ1ZfHBBKQOyH2N/GfoPpIp6IrvB+kkx2JTk2H+F66
tYdVI32s2ONlqiZJ0BMa/qfF0DUdnZ5vsI7iuBFY/wlqL8ZrqKNq8o9nnolc5iQ6
ygpwKGIowEkjLPV1A1Y+qkscMAJgp4FkFI37wUugWTRZAgMBAAGjYTBfMA4GA1Ud
DwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUkUWVvVRoiwWir478bC/gxUpTBuAwDQYJKoZI
hvcNAQELBQADggEBAJ1X7qOYIuJp/jAmekKEyZDYcgctlZ/qln6+JkiHHcdhn3rq
OsxVd16p0flWyNU7XEi/6rVklZ7tl39pgzyr9sOxuZoeiBa5edPekzqlkMOlA/Dg
S9lmVzddaja2dfnLqA1xGR6t67xEPLAnUxfcZneklMbbgzO3gk0Ffl3JLre4XMz1
XiGrB7VZFvH5336MMRvfCRNp76gdCMC3VmqU/RR/X2pA/Guq8C0Vm+7uuSIWJh1L
AdclEtL7s+4CQKTkd+7OdSs9QQvtJ38R7V+pReGrfbqKgYkock+1GmGmPlrXsrB6
yoPwu8L8Sjm9Lmi0Y3g3D9gmFeJCZJh3vCWeH7o=
-----END CERTIFICATE-----


Cert Chain:
-----BEGIN CERTIFICATE-----
MIIDTDCCAjSgAwIBAgIQTFuUDIM4eJ5HI1J2EFGd7zANBgkqhkiG9w0BAQsFADAV
MRMwEQYDVQQDDApHcnBjVGVzdENhMB4XDTIxMTAxMTAzMTgzMVoXDTIyMTAxMTAz
MzgxNlowFTETMBEGA1UEAwwKVEVTVFZNTUhTTTCCASIwDQYJKoZIhvcNAQEBBQAD
ggEPADCCAQoCggEBAPbcLAQXqdSr8ZN7k4WNjH7fN/m3/dEIj4+LZ41hpyveXmyW
EuwVTmDqdK7+6Rm394jiE7w0YnAppMsq/FP0u+xwjL3dVfHqo/pNQwtTBsnOwsrv
m1JVyF2/bnoo0aOmVV54e2ZMmh2PlvpiIr+hH0ko4w2sNqqhn+CVZ1k7y1xawg3X
dAPKI4bsr81dG6Wh234v183+Nzwa572LZLAnUrBtnZRWVcy5hVHZ8srwfzTAIN7t
DDjqv7MiECt/jvkERGFLBImpq17yQV8ZY2pyDaBeAZ3zhCnYRH/Ym8GUW8hcY8Rd
wYT+rga2UNU3iT1OzlVWF6onlmsWUx/KulUgMXECAwEAAaOBlzCBlDAOBgNVHQ8B
Af8EBAMCBDAwFQYDVR0RBA4wDIIKVEVTVFZNTUhTTTAMBgNVHRMBAf8EAjAAMB0G
A1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAfBgNVHSMEGDAWgBQiVDixN5NI
rYZBP3XV8HEX2a8MQTAdBgNVHQ4EFgQUtxhBJWW3eTxeQ9Q35TW0p0MbvyYwDQYJ
KoZIhvcNAQELBQADggEBAHT3vuWPgIG2fiSS/jJTf0Tbct3eKE2Szghs9o1/Mq5R
2BaigpgAB4d3qQ83yjW1GwLQjbu27kOMLtCdZCY45BsyALWyRbIur5r1Ku4ZkjQy
qXqag7ffgmfMsvADWEDGDfd6DjsekxxMF40fuvuuHC/BX3DA83oLAwbR8Gtow/zS
o8lEL3sU3h9yiSylUVuiq8ef07egGMpE2DWMa7iehIt0avUCeG1mllO9Ibwnx0Ro
/f9YLPykHRpGOgpyGVg43JvmvVGTlTMiaHABUTY9w8s7i5r+8cx1xChhLnFAWrmS
gWCtJL6TJCh0k7XUPm5h3KLF6HBtkPzJLjeoETRbEAQ=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDOjCCAiKgAwIBAgIQKayMb2Mi84VJ7cnAzGyeWDANBgkqhkiG9w0BAQsFADAX
MRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwHhcNMjExMDExMDMxODIzWhcNMjIxMDEx
MDMzODE2WjAVMRMwEQYDVQQDDApHcnBjVGVzdENhMIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEAxtLWXXmX/k6rRZByb5dGp4lZTUqw7WJn9sX+PBf+nRd1
RY5AFKMULZJOjFEs1cjIVa26Mnf0o/SazwembjEEw1X3SV6PfmP8HrWxrt2BGvm+
NB1esR8H/81M+6n2kCG1xAqo/UmUG177IWmYqbD4Owcj9380wJ64lFFHywFUY7L2
dC5nGFnxGg+9DCCJLV4FRLOzn5Th+6uU2lXTeM+HcR8JeOY7xX57o3WnQ2xK+sHh
tRkltvvwvQ0GKvf7tL1zaosetOsR3w6YoR3n9uloLR4B3UJONhmhg49/QNVciXU+
uNFuNU50qYweFhYVU00aUxiY8zr2dXerSzC05Ifb6QIDAQABo4GDMIGAMA4GA1Ud
DwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDwYDVR0T
AQH/BAUwAwEB/zAfBgNVHSMEGDAWgBSRRZW9VGiLBaKvjvxsL+DFSlMG4DAdBgNV
HQ4EFgQUIlQ4sTeTSK2GQT911fBxF9mvDEEwDQYJKoZIhvcNAQELBQADggEBAHTC
4i2O9vEUXSuVt7AXTxQW3RUOENUdXh1Q1VdqjBmmUz0ztTI87wgbgHrL9MeNv/22
gqHlD/6ud1RnieyFOsovssWz2kX43OlPuwcUOdjEXWSZwXQambqZHRkxT5fXm3Mg
v4lfV1vBYmsMUqBfujNC2u/xTSK4rSeWdnK2zagLrpdsQbmhLvasQi03MRtflrDn
U6lOAFP63iE+4ULzOZBgl7kM/JBdZKDdiM5Ybo2tGiYrfXyYasyflun3rUGU0Wa6
FZD3f8GgcCofvat6zRxYSVe9NZX+242FwHZopKtnjT0bPlsUKzba7Uf75Q/gvEuG
MKHEW/UIB1UahQBOBw0=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIQXsiKAgAAGp9P6sTRS5/xtDANBgkqhkiG9w0BAQsFADAX
MRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwHhcNMjExMDExMDMxODE2WhcNMjIxMDEx
MDMzODE2WjAXMRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQC8VDcLWvgYh5Trb47wuhxBxNb491089M+taAypWfC3
jGAnMoGV0gF54tNiBTUPeI50cwpFL5TIOzQaw9WnFvAEbkPhQv8wL7GLsXXLsAZc
VAdHdOcvCjKb51pOq69hFd41dOCa1EJn83Tq8SHdG+essoXlBWL1+sfu3zPsW8SO
wSgeLPQQJ3c6C6/V+f/RxbAZ1ZfHBBKQOyH2N/GfoPpIp6IrvB+kkx2JTk2H+F66
tYdVI32s2ONlqiZJ0BMa/qfF0DUdnZ5vsI7iuBFY/wlqL8ZrqKNq8o9nnolc5iQ6
ygpwKGIowEkjLPV1A1Y+qkscMAJgp4FkFI37wUugWTRZAgMBAAGjYTBfMA4GA1Ud
DwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUkUWVvVRoiwWir478bC/gxUpTBuAwDQYJKoZI
hvcNAQELBQADggEBAJ1X7qOYIuJp/jAmekKEyZDYcgctlZ/qln6+JkiHHcdhn3rq
OsxVd16p0flWyNU7XEi/6rVklZ7tl39pgzyr9sOxuZoeiBa5edPekzqlkMOlA/Dg
S9lmVzddaja2dfnLqA1xGR6t67xEPLAnUxfcZneklMbbgzO3gk0Ffl3JLre4XMz1
XiGrB7VZFvH5336MMRvfCRNp76gdCMC3VmqU/RR/X2pA/Guq8C0Vm+7uuSIWJh1L
AdclEtL7s+4CQKTkd+7OdSs9QQvtJ38R7V+pReGrfbqKgYkock+1GmGmPlrXsrB6
yoPwu8L8Sjm9Lmi0Y3g3D9gmFeJCZJh3vCWeH7o=
-----END CERTIFICATE-----


KeyId:
engine:e_akv:managedHsm:az400popmhsm3:testvmmhsm

Server Address: 0.0.0.0:50051
ServerBuilder: Build and Start listening
Server listening on 0.0.0.0:50051
E0107 20:56:50.050211464   25723 ssl_transport_security.cc:1839] No match found for server name: localhost.

Got Auth Context
mTLS checking...
common name: TESTVMMHSM
client cert AuthN & AuthZ passed
common name: TESTVMMHSM
'TESTVMMHSM' matched san 'TESTVMMHSM'

Got Auth Context
mTLS checking...
common name: TESTVMMHSM
client cert AuthN & AuthZ passed
common name: TESTVMMHSM
'TESTVMMHSM' matched san 'TESTVMMHSM'

```

### running log for client with RSA cert
```
grpc-linux$ ./rsa_client.sh
Root Certs:
-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIQXsiKAgAAGp9P6sTRS5/xtDANBgkqhkiG9w0BAQsFADAX
MRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwHhcNMjExMDExMDMxODE2WhcNMjIxMDEx
MDMzODE2WjAXMRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQC8VDcLWvgYh5Trb47wuhxBxNb491089M+taAypWfC3
jGAnMoGV0gF54tNiBTUPeI50cwpFL5TIOzQaw9WnFvAEbkPhQv8wL7GLsXXLsAZc
VAdHdOcvCjKb51pOq69hFd41dOCa1EJn83Tq8SHdG+essoXlBWL1+sfu3zPsW8SO
wSgeLPQQJ3c6C6/V+f/RxbAZ1ZfHBBKQOyH2N/GfoPpIp6IrvB+kkx2JTk2H+F66
tYdVI32s2ONlqiZJ0BMa/qfF0DUdnZ5vsI7iuBFY/wlqL8ZrqKNq8o9nnolc5iQ6
ygpwKGIowEkjLPV1A1Y+qkscMAJgp4FkFI37wUugWTRZAgMBAAGjYTBfMA4GA1Ud
DwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUkUWVvVRoiwWir478bC/gxUpTBuAwDQYJKoZI
hvcNAQELBQADggEBAJ1X7qOYIuJp/jAmekKEyZDYcgctlZ/qln6+JkiHHcdhn3rq
OsxVd16p0flWyNU7XEi/6rVklZ7tl39pgzyr9sOxuZoeiBa5edPekzqlkMOlA/Dg
S9lmVzddaja2dfnLqA1xGR6t67xEPLAnUxfcZneklMbbgzO3gk0Ffl3JLre4XMz1
XiGrB7VZFvH5336MMRvfCRNp76gdCMC3VmqU/RR/X2pA/Guq8C0Vm+7uuSIWJh1L
AdclEtL7s+4CQKTkd+7OdSs9QQvtJ38R7V+pReGrfbqKgYkock+1GmGmPlrXsrB6
yoPwu8L8Sjm9Lmi0Y3g3D9gmFeJCZJh3vCWeH7o=
-----END CERTIFICATE-----


Cert Chain:
-----BEGIN CERTIFICATE-----
MIIDTDCCAjSgAwIBAgIQTFuUDIM4eJ5HI1J2EFGd7zANBgkqhkiG9w0BAQsFADAV
MRMwEQYDVQQDDApHcnBjVGVzdENhMB4XDTIxMTAxMTAzMTgzMVoXDTIyMTAxMTAz
MzgxNlowFTETMBEGA1UEAwwKVEVTVFZNTUhTTTCCASIwDQYJKoZIhvcNAQEBBQAD
ggEPADCCAQoCggEBAPbcLAQXqdSr8ZN7k4WNjH7fN/m3/dEIj4+LZ41hpyveXmyW
EuwVTmDqdK7+6Rm394jiE7w0YnAppMsq/FP0u+xwjL3dVfHqo/pNQwtTBsnOwsrv
m1JVyF2/bnoo0aOmVV54e2ZMmh2PlvpiIr+hH0ko4w2sNqqhn+CVZ1k7y1xawg3X
dAPKI4bsr81dG6Wh234v183+Nzwa572LZLAnUrBtnZRWVcy5hVHZ8srwfzTAIN7t
DDjqv7MiECt/jvkERGFLBImpq17yQV8ZY2pyDaBeAZ3zhCnYRH/Ym8GUW8hcY8Rd
wYT+rga2UNU3iT1OzlVWF6onlmsWUx/KulUgMXECAwEAAaOBlzCBlDAOBgNVHQ8B
Af8EBAMCBDAwFQYDVR0RBA4wDIIKVEVTVFZNTUhTTTAMBgNVHRMBAf8EAjAAMB0G
A1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAfBgNVHSMEGDAWgBQiVDixN5NI
rYZBP3XV8HEX2a8MQTAdBgNVHQ4EFgQUtxhBJWW3eTxeQ9Q35TW0p0MbvyYwDQYJ
KoZIhvcNAQELBQADggEBAHT3vuWPgIG2fiSS/jJTf0Tbct3eKE2Szghs9o1/Mq5R
2BaigpgAB4d3qQ83yjW1GwLQjbu27kOMLtCdZCY45BsyALWyRbIur5r1Ku4ZkjQy
qXqag7ffgmfMsvADWEDGDfd6DjsekxxMF40fuvuuHC/BX3DA83oLAwbR8Gtow/zS
o8lEL3sU3h9yiSylUVuiq8ef07egGMpE2DWMa7iehIt0avUCeG1mllO9Ibwnx0Ro
/f9YLPykHRpGOgpyGVg43JvmvVGTlTMiaHABUTY9w8s7i5r+8cx1xChhLnFAWrmS
gWCtJL6TJCh0k7XUPm5h3KLF6HBtkPzJLjeoETRbEAQ=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDOjCCAiKgAwIBAgIQKayMb2Mi84VJ7cnAzGyeWDANBgkqhkiG9w0BAQsFADAX
MRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwHhcNMjExMDExMDMxODIzWhcNMjIxMDEx
MDMzODE2WjAVMRMwEQYDVQQDDApHcnBjVGVzdENhMIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEAxtLWXXmX/k6rRZByb5dGp4lZTUqw7WJn9sX+PBf+nRd1
RY5AFKMULZJOjFEs1cjIVa26Mnf0o/SazwembjEEw1X3SV6PfmP8HrWxrt2BGvm+
NB1esR8H/81M+6n2kCG1xAqo/UmUG177IWmYqbD4Owcj9380wJ64lFFHywFUY7L2
dC5nGFnxGg+9DCCJLV4FRLOzn5Th+6uU2lXTeM+HcR8JeOY7xX57o3WnQ2xK+sHh
tRkltvvwvQ0GKvf7tL1zaosetOsR3w6YoR3n9uloLR4B3UJONhmhg49/QNVciXU+
uNFuNU50qYweFhYVU00aUxiY8zr2dXerSzC05Ifb6QIDAQABo4GDMIGAMA4GA1Ud
DwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDwYDVR0T
AQH/BAUwAwEB/zAfBgNVHSMEGDAWgBSRRZW9VGiLBaKvjvxsL+DFSlMG4DAdBgNV
HQ4EFgQUIlQ4sTeTSK2GQT911fBxF9mvDEEwDQYJKoZIhvcNAQELBQADggEBAHTC
4i2O9vEUXSuVt7AXTxQW3RUOENUdXh1Q1VdqjBmmUz0ztTI87wgbgHrL9MeNv/22
gqHlD/6ud1RnieyFOsovssWz2kX43OlPuwcUOdjEXWSZwXQambqZHRkxT5fXm3Mg
v4lfV1vBYmsMUqBfujNC2u/xTSK4rSeWdnK2zagLrpdsQbmhLvasQi03MRtflrDn
U6lOAFP63iE+4ULzOZBgl7kM/JBdZKDdiM5Ybo2tGiYrfXyYasyflun3rUGU0Wa6
FZD3f8GgcCofvat6zRxYSVe9NZX+242FwHZopKtnjT0bPlsUKzba7Uf75Q/gvEuG
MKHEW/UIB1UahQBOBw0=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDGTCCAgGgAwIBAgIQXsiKAgAAGp9P6sTRS5/xtDANBgkqhkiG9w0BAQsFADAX
MRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwHhcNMjExMDExMDMxODE2WhcNMjIxMDEx
MDMzODE2WjAXMRUwEwYDVQQDDAxHcnBjVGVzdFJvb3QwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQC8VDcLWvgYh5Trb47wuhxBxNb491089M+taAypWfC3
jGAnMoGV0gF54tNiBTUPeI50cwpFL5TIOzQaw9WnFvAEbkPhQv8wL7GLsXXLsAZc
VAdHdOcvCjKb51pOq69hFd41dOCa1EJn83Tq8SHdG+essoXlBWL1+sfu3zPsW8SO
wSgeLPQQJ3c6C6/V+f/RxbAZ1ZfHBBKQOyH2N/GfoPpIp6IrvB+kkx2JTk2H+F66
tYdVI32s2ONlqiZJ0BMa/qfF0DUdnZ5vsI7iuBFY/wlqL8ZrqKNq8o9nnolc5iQ6
ygpwKGIowEkjLPV1A1Y+qkscMAJgp4FkFI37wUugWTRZAgMBAAGjYTBfMA4GA1Ud
DwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDwYDVR0T
AQH/BAUwAwEB/zAdBgNVHQ4EFgQUkUWVvVRoiwWir478bC/gxUpTBuAwDQYJKoZI
hvcNAQELBQADggEBAJ1X7qOYIuJp/jAmekKEyZDYcgctlZ/qln6+JkiHHcdhn3rq
OsxVd16p0flWyNU7XEi/6rVklZ7tl39pgzyr9sOxuZoeiBa5edPekzqlkMOlA/Dg
S9lmVzddaja2dfnLqA1xGR6t67xEPLAnUxfcZneklMbbgzO3gk0Ffl3JLre4XMz1
XiGrB7VZFvH5336MMRvfCRNp76gdCMC3VmqU/RR/X2pA/Guq8C0Vm+7uuSIWJh1L
AdclEtL7s+4CQKTkd+7OdSs9QQvtJ38R7V+pReGrfbqKgYkock+1GmGmPlrXsrB6
yoPwu8L8Sjm9Lmi0Y3g3D9gmFeJCZJh3vCWeH7o=
-----END CERTIFICATE-----


KeyId:
'engine:e_akv:managedHsm:az400popmhsm3:testvmmhsm'

Server Address: localhost:50051
Server Name: localhost
Set client cert
Creating Custom Channel
Callback Schedule
Callback TargetName: localhost
Chain is verified
Greeter world received: Hello TESTVMMHSM:world
Reuse Custom Channel
Greeter azure received: Hello TESTVMMHSM:azure

```


### running log for server with EC cert
```
grpc-linux$ ./ec_server.sh
Root Certs:
-----BEGIN CERTIFICATE-----
MIIByjCCAW8CFHxsuYVvguPNS5QajJQFltG+xbbKMAoGCCqGSM49BAMCMGcxCzAJ
BgNVBAYTAlVTMQswCQYDVQQIDAJXQTEQMA4GA1UEBwwHUmVkbW9uZDEQMA4GA1UE
CgwHQ29udG9zbzENMAsGA1UECwwETUhTTTEYMBYGA1UEAwwPd3d3LkNvbnRvc28u
Y29tMB4XDTIxMTAxNzE3NTExMFoXDTIyMTAxNzE3NTExMFowZzELMAkGA1UEBhMC
VVMxCzAJBgNVBAgMAldBMRAwDgYDVQQHDAdSZWRtb25kMRAwDgYDVQQKDAdDb250
b3NvMQ0wCwYDVQQLDARNSFNNMRgwFgYDVQQDDA93d3cuQ29udG9zby5jb20wWTAT
BgcqhkjOPQIBBggqhkjOPQMBBwNCAAQQ+sCm4w87jSHUDU1gwav+Yz6QstJ6JSOt
eFOeSpSJfWD1Y4uckYqvLAAsN0Y7DFxygj537PW7h4pzU84cOjHOMAoGCCqGSM49
BAMCA0kAMEYCIQDr+iHYxN+/IA/ymixeZudC6bIjjaxs3RsApuIZd5f89gIhAKn5
VYdkfCYhke+4UKx2v3RENQLeO9C3KPwhlVxLzMR+
-----END CERTIFICATE-----


Cert Chain:
-----BEGIN CERTIFICATE-----
MIIByjCCAW8CFHxsuYVvguPNS5QajJQFltG+xbbKMAoGCCqGSM49BAMCMGcxCzAJ
BgNVBAYTAlVTMQswCQYDVQQIDAJXQTEQMA4GA1UEBwwHUmVkbW9uZDEQMA4GA1UE
CgwHQ29udG9zbzENMAsGA1UECwwETUhTTTEYMBYGA1UEAwwPd3d3LkNvbnRvc28u
Y29tMB4XDTIxMTAxNzE3NTExMFoXDTIyMTAxNzE3NTExMFowZzELMAkGA1UEBhMC
VVMxCzAJBgNVBAgMAldBMRAwDgYDVQQHDAdSZWRtb25kMRAwDgYDVQQKDAdDb250
b3NvMQ0wCwYDVQQLDARNSFNNMRgwFgYDVQQDDA93d3cuQ29udG9zby5jb20wWTAT
BgcqhkjOPQIBBggqhkjOPQMBBwNCAAQQ+sCm4w87jSHUDU1gwav+Yz6QstJ6JSOt
eFOeSpSJfWD1Y4uckYqvLAAsN0Y7DFxygj537PW7h4pzU84cOjHOMAoGCCqGSM49
BAMCA0kAMEYCIQDr+iHYxN+/IA/ymixeZudC6bIjjaxs3RsApuIZd5f89gIhAKn5
VYdkfCYhke+4UKx2v3RENQLeO9C3KPwhlVxLzMR+
-----END CERTIFICATE-----


KeyId:
engine:e_akv:managedHsm:az400popmhsm3:ecckey

Server Address: 0.0.0.0:50051
ServerBuilder: Build and Start listening
Server listening on 0.0.0.0:50051
E0107 21:00:16.994645109   26310 ssl_transport_security.cc:1839] No match found for server name: localhost.

Got Auth Context
mTLS checking...
common name: www.Contoso.com
client cert AuthN & AuthZ passed
common name: www.Contoso.com

Got Auth Context
mTLS checking...
common name: www.Contoso.com
client cert AuthN & AuthZ passed
common name: www.Contoso.com

```

### running log for client with EC cert
```
/grpc-linux$ ./ec_client.sh
Root Certs:
-----BEGIN CERTIFICATE-----
MIIByjCCAW8CFHxsuYVvguPNS5QajJQFltG+xbbKMAoGCCqGSM49BAMCMGcxCzAJ
BgNVBAYTAlVTMQswCQYDVQQIDAJXQTEQMA4GA1UEBwwHUmVkbW9uZDEQMA4GA1UE
CgwHQ29udG9zbzENMAsGA1UECwwETUhTTTEYMBYGA1UEAwwPd3d3LkNvbnRvc28u
Y29tMB4XDTIxMTAxNzE3NTExMFoXDTIyMTAxNzE3NTExMFowZzELMAkGA1UEBhMC
VVMxCzAJBgNVBAgMAldBMRAwDgYDVQQHDAdSZWRtb25kMRAwDgYDVQQKDAdDb250
b3NvMQ0wCwYDVQQLDARNSFNNMRgwFgYDVQQDDA93d3cuQ29udG9zby5jb20wWTAT
BgcqhkjOPQIBBggqhkjOPQMBBwNCAAQQ+sCm4w87jSHUDU1gwav+Yz6QstJ6JSOt
eFOeSpSJfWD1Y4uckYqvLAAsN0Y7DFxygj537PW7h4pzU84cOjHOMAoGCCqGSM49
BAMCA0kAMEYCIQDr+iHYxN+/IA/ymixeZudC6bIjjaxs3RsApuIZd5f89gIhAKn5
VYdkfCYhke+4UKx2v3RENQLeO9C3KPwhlVxLzMR+
-----END CERTIFICATE-----


Cert Chain:
-----BEGIN CERTIFICATE-----
MIIByjCCAW8CFHxsuYVvguPNS5QajJQFltG+xbbKMAoGCCqGSM49BAMCMGcxCzAJ
BgNVBAYTAlVTMQswCQYDVQQIDAJXQTEQMA4GA1UEBwwHUmVkbW9uZDEQMA4GA1UE
CgwHQ29udG9zbzENMAsGA1UECwwETUhTTTEYMBYGA1UEAwwPd3d3LkNvbnRvc28u
Y29tMB4XDTIxMTAxNzE3NTExMFoXDTIyMTAxNzE3NTExMFowZzELMAkGA1UEBhMC
VVMxCzAJBgNVBAgMAldBMRAwDgYDVQQHDAdSZWRtb25kMRAwDgYDVQQKDAdDb250
b3NvMQ0wCwYDVQQLDARNSFNNMRgwFgYDVQQDDA93d3cuQ29udG9zby5jb20wWTAT
BgcqhkjOPQIBBggqhkjOPQMBBwNCAAQQ+sCm4w87jSHUDU1gwav+Yz6QstJ6JSOt
eFOeSpSJfWD1Y4uckYqvLAAsN0Y7DFxygj537PW7h4pzU84cOjHOMAoGCCqGSM49
BAMCA0kAMEYCIQDr+iHYxN+/IA/ymixeZudC6bIjjaxs3RsApuIZd5f89gIhAKn5
VYdkfCYhke+4UKx2v3RENQLeO9C3KPwhlVxLzMR+
-----END CERTIFICATE-----


KeyId:
'engine:e_akv:managedHsm:az400popmhsm3:ecckey'

Server Address: localhost:50051
Server Name: localhost
Set client cert
Creating Custom Channel
Callback Schedule
Callback TargetName: localhost
Chain is verified
Greeter world received: Hello world
Reuse Custom Channel
Greeter azure received: Hello azure

```